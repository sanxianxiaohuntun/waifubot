# WaifuBot QQ机器人

一个功能强大的QQ机器人，集成了AI对话、角色扮演、语音合成、图片生成、记忆管理等多种功能。支持WebUI可视化配置管理，无需编程基础即可轻松使用，无需任何环境开箱即用。

## 简介
1. 一键安装无需部署，自动更新。
2. 能够识别各种代码文件、图片、视频、文本文档、网页链接等……
3. 自带绘图、语音、长期记忆（智能总结最多测试过召回1年以上记忆）
4. 全自动分段，语音非复读而是模型决定是否使用。
5. 全自动人设生成、和AI对话即可生成一键导入人设。
6. 可视化webui编辑各类配置，告别看不懂代码、json、yaml情况。
7. 模型自己选择调用联网、绘图、语音、网易云点歌等。
8. 自带破甲、目前可破gemini、deepseek、Claude等，解除模型限制可在webui自行编辑破甲。
9. 自动向量化长期记忆，准确召回。最长可召回1年前记忆（还没测试更长时间）
10. 模型有重要事件记事本，模型可以自我记录重要信息，比如：2025年8月9日 是用户生日。webui中用户可自行修改删除重要事件以及tga（类似酒馆世界书，比哪个复杂点）
11. 有2种LLM模式LLM1和LLM2，在LLM1中可以使用任何openai中转站或openai格式模型，LLM2中只可以使用允许结构化请求模型。
12. 有3种提示词模式，酒馆模式（第三人称互动式小说对话）、角色扮演模式（第一人称扮演对话）、助手模式（调用绘图、语音、文本、查看代码文件、文本文件、图片文件）进行多模态辅助。
13. 模型增强：自带思考（思考如何像一个人、分析用户输入如何达成目标、调用那些工具）、生活轨迹（你长时间（1小时左右）没有找它，它会自己去做自己的事情）、时间观念（知道你多久没找他了，知道现在几点了什么日子）。
14. 自定义：可以自定义文风、回答个性、人设、各种LLM规则。


## 保持更新
点击仓库右上角 Star 和 Watch 按钮，获取最新动态。


![68747470733a2f2f646f63732e6c616e67626f742e6170702f737461722e676966](https://github.com/user-attachments/assets/987cf418-d964-484d-8c8c-ddbe5b152030)

<details>
<summary><strong style="font-size: 32px; color: #0366d6;">📸 使用图片 (点击展开/收起)</strong></summary>

![78de331777224eb131d570c5482d01cf](https://github.com/user-attachments/assets/9c7d5f50-8abc-4ad1-afea-581223fed520)
![d2ec6e151be261ab75d5d992c57e8078](https://github.com/user-attachments/assets/91f1012f-c860-4b5e-8680-8b87bfcee001)
![ca221e0941184c013ae0eba32c9d3c77](https://github.com/user-attachments/assets/18f51cc3-de54-46ce-a766-9d5fa570c1e9)

</details>

<details>
<summary><strong style="font-size: 32px; color: #0366d6;">🖥️ WebUI界面截图 (点击展开/收起)</strong></summary>

<img width="1897" height="852" alt="image" src="https://github.com/user-attachments/assets/500263fa-6137-4de4-b698-a0b68430a3ae" />
<img width="1895" height="835" alt="image" src="https://github.com/user-attachments/assets/d9e05714-ed35-4004-8118-83b59d1a5aa7" />
<img width="1901" height="831" alt="image" src="https://github.com/user-attachments/assets/7632de0b-cff7-485f-9f42-687218f4c9c6" />
<img width="1919" height="830" alt="image" src="https://github.com/user-attachments/assets/cd67ae4a-7bfe-4d77-9333-8c0d041ad83b" />
<img width="1919" height="869" alt="image" src="https://github.com/user-attachments/assets/79574d5e-1faa-4382-ba7e-60dc78f13484" />
<img width="1919" height="881" alt="image" src="https://github.com/user-attachments/assets/722ca665-523b-43ed-b26b-d2c369b8913f" />
<img width="1919" height="827" alt="image" src="https://github.com/user-attachments/assets/c11252e2-ae4e-4988-be45-3dea1cb9ba74" />
<img width="1895" height="858" alt="image" src="https://github.com/user-attachments/assets/9ca321ef-a02b-400d-8630-04bc32aa526c" />

</details>

<details>
<summary><strong style="font-size: 18px; color: #0366d6;">⚙️ WebUI功能配置截图 (点击展开/收起)</strong></summary>

<img width="780" height="533" alt="image" src="https://github.com/user-attachments/assets/1605b37d-ecdd-4b62-8bb2-16d39f9449d3" />
<img width="749" height="543" alt="image" src="https://github.com/user-attachments/assets/02d9cc5a-5341-41f1-b09c-844346895eea" />
<img width="777" height="547" alt="image" src="https://github.com/user-attachments/assets/c4dd4e62-aaba-43cc-8ed7-11535d8e997d" />
<img width="1564" height="830" alt="image" src="https://github.com/user-attachments/assets/0d9e92ee-e115-41cd-b173-b90dfe9ac1af" />
<img width="817" height="438" alt="image" src="https://github.com/user-attachments/assets/104f7d8d-06c2-4eb7-a657-dd29981196bf" />

</details>

<details>
<summary><strong style="font-size: 32px; color: #0366d6;">🤖 Bot端截图 (点击展开/收起)</strong></summary>

<img width="802" height="639" alt="image" src="https://github.com/user-attachments/assets/c1897477-77cb-4ce9-bab1-30729968d005" />

</details>

## 📦 安装与启动

### 下载安装

#### 点击跳转到 [releases](https://github.com/sanxianxiaohuntun/waifubot/releases/) 下载

rar版本：
1. 点击 releases 找到最新版本
2. 解压到任意目录
3. 无需安装，直接运行即可

exe版本：
1. 双击waifubot.exe
2. 无脑下一步
3. 双击桌面waifuQQ机器人 图标运行


### 启动方式

#### waifubot界面启动
1. 双击运行 `waifubot.exe`
2. 在软件界面中点击"启动机器人"打开QQ登录。
3. 点击"打开WebUI"进入管理界面，配置。

### 首次运行
- 程序会自动创建必要的配置文件和目录
- 首次启动需要配置API密钥才能正常使用
- 建议先通过WebUI进行基础配置



## 🌟 主要特色

### 🤖 智能对话
- **多模式对话**：支持角色扮演模式、助手模式、酒馆模式
- **长期记忆**：自动保存和检索对话历史，实现连续对话体验
- **短期记忆**：实时记录当前对话上下文
- **智能摘要**：自动对长期记忆进行摘要和标签化

### 🎭 角色扮演
- **个性化角色**：为每个用户/群组配置专属角色设定
- **角色生成器**：AI辅助生成角色设定和配置，支持对话式角色创建
- **多角色支持**：支持不同场景下的角色切换
- **情感表达**：丰富的表情包系统，增强互动体验
- **角色模板**：内置多种角色模板，快速创建个性化角色

### 🎨 多媒体功能
- **语音合成**：支持TTS语音回复，多种音色可选
- **图片生成**：AI绘图功能，支持自拍、合影等场景
- **表情包管理**：可视化表情包上传、分类、管理
- **文件处理**：支持图片、文档等多种文件格式

### 🌐 智能识别
- **图片识别**：自动识别图片内容并生成描述，支持多种图片格式
- **网页识别**：智能解析网页链接内容，提取关键信息
- **语音转文字**：支持语音消息转文字处理，实时转换
- **合并转发处理**：智能处理QQ合并转发消息，提取转发内容
- **引用消息处理**：只能识别引用消息
- **文件处理**：支持文档、图片等多种文件格式的智能处理

### ⚙️ 可视化配置
- **WebUI界面**：现代化的Web管理界面
- **实时配置**：无需重启即可应用配置更改
- **用户管理**：可视化用户和群组管理
- **数据统计**：实时显示系统运行状态和统计数据

## 🚀 快速开始

### 系统要求
- Windows 10/11
- 已封包为exe文件，开箱即用

### 初始配置

1. **API密钥配置**
   - 直接使用启航api一键配置或如下：
   - 在WebUI的"全局配置"页面配置OpenAI API密钥
   - 配置TTS、图片生成等服务的API密钥

2. **权限设置**
   - 设置白名单/黑名单用户和群组
   - 配置群聊回复模式

3. **角色配置**
   - 在"角色生成器"中创建个性化角色
   - 设置对话模式和记忆参数

## 📋 功能详解

### 对话模式
- **角色扮演模式**：沉浸式角色扮演体验
- **助手模式**：智能助手对话模式
- **酒馆模式**：你懂得

### 记忆系统
- **短期记忆**：保存最近X条对话记录，实时更新
- **长期记忆**：自动摘要存储重要对话，支持标签化、向量化。
- **智能检索**：基于标签和相似度检索相关记忆
- **记忆管理**：可视化记忆查看和编辑，支持批量操作
- **记忆清理**：自动清理过期记忆，优化存储空间

### 多媒体功能
- **TTS语音**：支持多种音色和模型
- **AI绘图**：支持自拍、合影、场景绘制
- **表情包**：分类管理，随机发送
- **文件处理**：支持图片、文档等格式

### 智能识别
- **图片识别**：自动识别图片内容，支持多种图片格式
- **网页解析**：智能提取网页信息，自动生成摘要
- **语音转文字**：处理语音消息，实时转换
- **关键词触发**：自定义关键词回复，支持正则表达式
- **文件识别**：智能识别文档内容，支持多种格式

### 定时功能
- **定时提醒**：设置定时任务和提醒
- **群聊定时器**：群组定时功能
- **私聊定时器**：个人定时功能

## 🎛️ WebUI管理界面

### 仪表板
- 系统运行状态监控
- 用户和群组统计
- 记忆数据统计
- 最近活动记录

### 全局配置
- API密钥管理
- 权限设置
- 功能开关
- 网络配置

### 用户管理
- 用户列表查看，支持搜索和筛选
- 用户详情编辑，个性化配置
- 角色配置管理，快速切换角色
- 记忆数据管理，可视化编辑记忆
- 群组管理，批量操作支持

### 角色生成器
- AI辅助角色创建，对话式角色设计
- 角色设定编辑，可视化配置界面
- 模板管理，内置多种角色模板
- 批量生成，快速创建多个角色
- 角色预览，实时查看角色效果

### 表情包管理
- 分类管理，支持自定义分类
- 图片上传，支持拖拽上传
- 批量操作，快速管理大量图片
- 预览功能，实时查看图片效果
- 智能分类，自动识别图片类型

### 数据管理
- 记忆数据查看，可视化编辑记忆
- 配置备份恢复，一键备份配置
- 数据清理，自动清理过期数据
- 导入导出，支持数据迁移
- 数据统计，实时监控数据使用情况

## 🔧 高级配置

### 权限模式
- **白名单模式**：仅允许指定用户/群组
- **黑名单模式**：屏蔽指定用户/群组
- **全部接收**：接收所有消息

### 群聊回复模式
- **模式1**：仅回复@消息，避免群聊干扰
- **模式2**：回复所有消息，活跃群聊氛围
- **模式3**：关键词或@触发，自定义触发条件
- **模式4**：AI智能判断，根据内容智能决定是否回复

## 更新日志

<details>
<summary>0.0.1.1 更新 (2025/07/29 01:44)</summary>

*   **新增功能**: 人设卡生成后导入功能
*   **问题修复**: 修复了 WebUI 的所有已知 Bug
*   **配置更新**: 加入模型生成创意度调整功能

</details>

<details>
<summary>0.0.1.2 更新 (2025/07/29 03:16)</summary>

*   **问题修复**: 修复了一键导入人设卡需要输入群聊/私聊前续的问题
*   **模型兼容**: 兼容了一些老模型不支持格式化返回的问题，例如：
    *   `gemini-1.5-pro`
    *   `deepseek-chat (v3)`
    *   `deepseek-reasoner (r1)`
*   **模型推荐**: 推荐使用更聪明的模型，例如：`gemini-2.5-pro`
*   **注意事项**:
    *   某些 API 不支持结构化返回时，使用 `##清空记忆` 命令清空记忆并更换模型。
    *   如需禁用某些工具调用（绘图、语音、音乐），在人设卡最后告知 LLM 不要调用，例如：`禁止使用：语音、音乐、绘图功能。`

</details>

<details>
<summary>0.0.1.3 更新 (2025/08/02 09:00)</summary>

1.  **WebUI 角色卡**:
    *   生成角色卡部分支持持久化记忆；用户不删除不会重置。
    *   可以重新生成和复制内容。
2.  **WebUI 功能开关**: 图片和语音生成功能可以通过开关进行控制。关闭后：
    *   语音将通过文本发送。
    *   绘图将不会生成。
3.  **LLM 模式**: 完成了 LLM1 和 LLM2 模式的完整架构：
    *   **LLM1 模式**: Token 消耗增加 1000-2000，但模型能够结构化请求。
    *   **LLM2 模式**: Token 消耗较少，但需要 API 站点和模型支持结构化请求。
4.  **自定义**:
    *   可以自定义破甲文本。
    *   新增 LLM 提示词修改：TOP 部分为顶部注入，END 部分为聊天记录和用户当前输入下方注入，用于伪造 AI 回复。
5.  **问题修复**: 修复了若干 Bug。
6.  **模式更新**: 更新了酒馆模式（第三人称，需要角色卡是第三人称）、助手模式（完全多模态辅助用户完成内容）、角色扮演模式（传统 Waifu 模式）。

</details>

<details>
<summary>0.0.1.4 更新 (2025/08/03 03:50)</summary>

1.  **问题修复**: 解决了返回不支持 XML 和 JSON 报错的问题，增加重试机制。
2.  **问题修复**: 解决了百度 `deepseek v3` 不允许非 user 内容结尾的问题。
3.  **性能优化**: 减少长对话下的 Token 消耗，稳定输出。
4.  **异常处理**: 增加异常处理机制，提供更好的异常处理。

</details>

<details>
<summary>0.0.1.5 更新 (2025/08/04 22:14)</summary>

1.  **问题修复**: 修复了模型返回表情包错误以及格式化错误的问题。
2.  **优化**: 系统不再对大小写敏感。
3.  **问题修复**: 修复了若干 Bug。
4.  **模型兼容**: 对便宜模型兼容效果更好了。
5.  **问题修复**: 解决了杀毒软件报毒问题。
6.  **模型兼容**: 兼容了 `deepseek` 全模型的格式问题。

</details>

<details>
<summary>0.0.1.6 更新 (2025/08/05 03:12)</summary>

1.  **问题修复**: 解决了模型在群聊中一次回复多个人问题，现在回复不同的人会 @ 不同的人。
2.  **群聊优化**: 解决了群聊中先触发 bot 再说问题的事情，现在会延迟等待 10-20 秒，没后续消息才触发 LLM（最短 10 秒，最多 20 秒）。
3.  **问题修复**: 解决了 Bot 会忘记自己状态，导致绘图场景不一致和跳跃式位置问题。

</details>

<details>
<summary>0.0.1.7 更新 (2025/08/06 05:03)</summary>

1.  **问题修复**: 修复了群聊中等待时间的逻辑问题。
2.  **WebUI 更新**: WebUI 增加了群聊等待时间配置（在群聊/用户管理和默认模板配置中）。
3.  **优化**: 优化了提示词结构。
4.  **问题修复**: 修复了若干 Bug。

</details>

<details>
<summary>0.0.1.8 更新 (2025/08/06 11:33)</summary>

1.  **模式更新**: 完成了酒馆模式和助手模式的设计，允许进行非第一人称回复。

</details>

<details>
<summary>0.0.1.9 更新 (2025/08/07 16:28)</summary>

1.  **新增功能**: 新增了记事本功能，Bot 会通过记事本记录内容。让它不要忘记、记住的东西，它会记录到记事本永久记忆。通过向量化文本，然后向量 + 弧相似度 + 关键词召回最相关的 50 条，Bot 不再忘记重要事件。

</details>

<details>
<summary>0.0.2.0 更新 (2025/08/08 14:26)</summary>

1.  **新增功能**: 新增了记事本功能，Bot 会通过记事本记录内容。让它不要忘记、记住的东西，它会记录到记事本永久记忆。通过向量化文本，然后向量 + 弧相似度 + 关键词召回最相关的 50 条，Bot 不再忘记重要事件。
2.  **WebUI 更新**: 记事本可以在 WebUI 里删除对应内容了。
3.  **新增功能**: 添加在线更新功能，可以自动更新啦！

</details>

<details>
<summary>0.0.2.1 更新 (2025/08/08 15:16)</summary>

1.  **修复**: 修复了webui人设卡导入、修改、新建都会读默认人设问题。

</details>

<details>
<summary>0.0.2.2 更新 (2025/08/09 08:49)</summary>

1. **更新**：webui新增删除人设卡功能
2. **更新**：webui保存会提示保存成功/失败了
3. **修复**：修复了 ID为None 的打印问题

</details>



## 📄 许可证

本项目为闭源软件，全免费使用，禁止任何商业用途，仅供学习参考大模型玩法和QQbot测试使用，禁止任何非法用途，所有非法使用的法律责任项目作者不承担任何责任。

## 👨‍💻 开发者

**小馄饨** - 项目开发者  


**E-mail：2926253308@qq.com**


**QQ交流群**：496144593

---

*感谢使用WaifuBot QQ机器人！如有问题请查看日志文件或联系开发者。*
